/**
 *
 * Please note:
 * This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * Do not edit this file manually.
 *
 */

@file:Suppress(
    "ArrayInDataClass",
    "EnumEntryName",
    "RemoveRedundantQualifierName",
    "UnusedImport"
)

package com.flagent.client.apis

import io.kotest.matchers.shouldBe
import io.kotest.core.spec.style.ShouldSpec
import io.ktor.client.engine.mock.MockEngine
import io.ktor.client.engine.mock.respond
import io.ktor.http.HttpHeaders
import io.ktor.http.HttpStatusCode
import io.ktor.utils.io.ByteReadChannel
import kotlinx.coroutines.test.runTest

/**
 * Export API tests. getExportEvalCacheJSON returns Map<String, Any>; getExportSQLite returns ByteArray.
 * With MockEngine + ContentNegotiation we only verify request/status (body deserialization has limits).
 */
class ExportApiTest : ShouldSpec() {
    init {
        should("test getExportEvalCacheJSON") {
            runTest {
                val json = """{"revision":"r1","flags":{},"experiments":{}}"""
                val mockEngine = MockEngine {
                    respond(ByteReadChannel(json), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/json"))
                }
                val api = ExportApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                val response = api.getExportEvalCacheJSON()
                response.status shouldBe 200
                response.success shouldBe true
                // Body is Map<String, Any>; kotlinx.serialization has no default serializer for Map, so we only assert status.
            }
        }

        should("test getExportSQLite") {
            runTest {
                val mockEngine = MockEngine {
                    respond(ByteReadChannel(ByteArray(0)), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/octet-stream"))
                }
                val api = ExportApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                val response = api.getExportSQLite(excludeSnapshots = true)
                response.status shouldBe 200
                response.success shouldBe true
                // File response type is not handled by ContentNegotiation in mock; integration test with real server would assert body.
            }
        }
    }
}
