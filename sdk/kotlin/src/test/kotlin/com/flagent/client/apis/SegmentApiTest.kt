/**
 *
 * Please note:
 * This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * Do not edit this file manually.
 *
 */

@file:Suppress(
    "ArrayInDataClass",
    "EnumEntryName",
    "RemoveRedundantQualifierName",
    "UnusedImport"
)

package com.flagent.client.apis

import io.kotest.matchers.shouldBe
import io.kotest.core.spec.style.ShouldSpec
import io.ktor.client.engine.mock.MockEngine
import io.ktor.client.engine.mock.respond
import io.ktor.http.HttpHeaders
import io.ktor.http.HttpStatusCode
import io.ktor.utils.io.ByteReadChannel
import kotlinx.coroutines.test.runTest
import com.flagent.client.models.CreateSegmentRequest
import com.flagent.client.models.PutSegmentRequest
import com.flagent.client.models.PutSegmentReorderRequest

class SegmentApiTest : ShouldSpec() {
    private val segmentJson = """{"id":1,"flagID":10,"description":"Segment 1","rank":0,"rolloutPercent":100}"""
    private val segmentListJson = """[$segmentJson]"""

    init {
        should("test createSegment") {
            runTest {
                val mockEngine = MockEngine {
                    respond(ByteReadChannel(segmentJson), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/json"))
                }
                val api = SegmentApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                val response = api.createSegment(10L, CreateSegmentRequest(description = "Seg", rolloutPercent = 100L))
                response.status shouldBe 200
                response.body().description shouldBe "Segment 1"
            }
        }

        should("test deleteSegment") {
            runTest {
                val mockEngine = MockEngine {
                    respond(ByteReadChannel("{}"), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/json"))
                }
                val api = SegmentApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                api.deleteSegment(1L, 1L)
            }
        }

        should("test findSegments") {
            runTest {
                val mockEngine = MockEngine {
                    respond(ByteReadChannel(segmentListJson), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/json"))
                }
                val api = SegmentApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                val response = api.findSegments(1L)
                response.status shouldBe 200
                val body = response.body()
                body.size shouldBe 1
                body[0].flagID shouldBe 10L
            }
        }

        should("test putSegment") {
            runTest {
                val mockEngine = MockEngine {
                    respond(ByteReadChannel(segmentJson), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/json"))
                }
                val api = SegmentApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                val response = api.putSegment(1L, 1L, PutSegmentRequest(description = "Updated", rolloutPercent = 50L))
                response.status shouldBe 200
                response.body().rolloutPercent shouldBe 100L
            }
        }

        should("test putSegmentReorder") {
            runTest {
                val mockEngine = MockEngine {
                    respond(ByteReadChannel("{}"), HttpStatusCode.OK, io.ktor.http.headersOf(HttpHeaders.ContentType, "application/json"))
                }
                val api = SegmentApi(baseUrl = "http://localhost", httpClientEngine = mockEngine)
                api.putSegmentReorder(1L, PutSegmentReorderRequest(segmentIDs = listOf(2L, 1L)))
            }
        }
    }
}
